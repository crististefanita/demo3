# Agentic Capability Resolution Rules â€” v1
# Purpose:
# Declarative rules used by Agentic AI to transform ScenarioDefinition INTENT
# into an executable scenario based on real framework capabilities.
#
# This artifact contains NO code and NO service bindings.
# It operates only on (action, resource) pairs and semantic intent.

capabilityResolutionVersion: v1

principles:
  - ScenarioDefinition expresses INTENT, not implementation.
  - Missing capabilities MUST be resolved via semantic fallback when possible.
  - Framework capabilities are authoritative (from Agentic_Bridge_Mapping).
  - Transformation MUST preserve test value whenever possible.
  - Unsafe or meaningless steps MUST be removed.

resolutionOrder:
  - direct-capability
  - semantic-fallback
  - degrade
  - remove

rules:

  # ----------------------------------
  # Direct capability (no transform)
  # ----------------------------------
  - id: direct-capability
    when:
      capabilityExists: true
    then:
      action: execute
    note: Use bridge mapping as-is.

  # ----------------------------------
  # Comment creation fallback
  # ----------------------------------
  - id: create-comment-fallback
    when:
      action: create
      resource: comment
      capabilityExists: false
    then:
      transform:
        to:
          action: verify
          resource: post
        rationale: >
          Comments cannot be created directly.
          Verify comment existence indirectly via parent post.
    severity: soft-degrade

  # ----------------------------------
  # Comment verification fallback
  # ----------------------------------
  - id: verify-comment-fallback
    when:
      action: verify
      resource: comment
      capabilityExists: false
    then:
      transform:
        to:
          action: get
          resource: post
        rationale: >
          Comment verification is inferred from post retrieval.
    severity: soft-degrade

  # ----------------------------------
  # Generic verify fallback
  # ----------------------------------
  - id: generic-verify-fallback
    when:
      action: verify
      capabilityExists: false
    then:
      transform:
        to:
          action: get
          resource: "{parentResource}"
        rationale: >
          Verification is performed via GET on nearest parent resource.
    severity: soft-degrade

  # ----------------------------------
  # Delete root strategy
  # ----------------------------------
  - id: delete-root
    when:
      action: delete
      resource: root
      capabilityExists: true
    then:
      action: execute
    note: Cleanup strategy handled by framework.

  # ----------------------------------
  # Unsupported creation
  # ----------------------------------
  - id: unsupported-create
    when:
      action: create
      capabilityExists: false
    then:
      action: remove
      rationale: >
        Creation cannot be inferred and has no safe fallback.
    severity: hard-remove

  # ----------------------------------
  # Unsupported action (catch-all)
  # ----------------------------------
  - id: unsupported-action
    when:
      capabilityExists: false
    then:
      action: remove
      rationale: >
        No meaningful or safe fallback exists.
    severity: hard-remove

outputs:
  executableStep:
    fields:
      - stepId
      - action
      - resource
      - dependsOn
      - originStepId
      - resolutionRuleId

notes:
  - This artifact is evaluated BEFORE bridge resolution.
  - Bridge mapping remains static and unchanged.
  - Scenario steps may be transformed, degraded, or removed.
